services:
  # =========================
  # Frontend Hub (solo hub, sin API ni m√≥dulos)
  # =========================
  hub-frontend:
    build:
      context: .
      dockerfile: Dockerfile
      target: dev-with-nginx
    container_name: multisystem-hub-frontend
    restart: unless-stopped
    environment:
      NODE_ENV: development
      PORT: 3005
      HOSTNAME: "0.0.0.0"
      NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-http://api:3000}
      NEXT_PUBLIC_SHOPFLOW_URL: ${NEXT_PUBLIC_SHOPFLOW_URL:-http://shopflow-frontend:3003}
      NEXT_PUBLIC_WORKIFY_URL: ${NEXT_PUBLIC_WORKIFY_URL:-http://workify-frontend:3004}
      NEXT_PUBLIC_SHOPFLOW_ENABLED: ${NEXT_PUBLIC_SHOPFLOW_ENABLED:-"false"}
      NEXT_PUBLIC_WORKIFY_ENABLED: ${NEXT_PUBLIC_WORKIFY_ENABLED:-"false"}
      NEXT_TELEMETRY_DISABLED: 1
      WATCHPACK_POLLING: true
      CHOKIDAR_USEPOLLING: true
    ports:
      - "80:80"
      - "3005:3005"
    volumes:
      - ./:/app
      - /app/node_modules
      - /app/.next
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    networks:
      - multisystem-network
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

# =========================
# Redes
# =========================
networks:
  multisystem-network:
    driver: bridge
